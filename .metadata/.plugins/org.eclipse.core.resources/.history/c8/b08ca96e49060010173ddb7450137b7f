<%@page import="java.util.List"%>
<%@page import="com.menu.bean.MenuBean"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ğŸ½ èœå–®åˆ—è¡¨</title>

<!-- Bootstrap -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- DataTables -->
<link rel="stylesheet"
	href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">

<style>
body {
	background-color: #f8f9fa;
}

table {
	background-color: white;
}

th {
	background-color: #007bff;
	color: white;
	text-align: center;
}

td {
	text-align: center;
	vertical-align: middle;
}

img {
	width: 100px;
	height: auto;
	border-radius: 5px;
}

.btn-back {
	display: block;
	width: 200px;
	margin: 20px auto;
	padding: 10px;
	text-align: center;
	background-color: #28a745;
	color: white;
	text-decoration: none;
	border-radius: 5px;
}

.btn-back:hover {
	background-color: #218838;
}

.btn-sm {
	margin-right: 5px;
}
</style>
</head>
<body>

	<!-- é¡¯ç¤ºåˆªé™¤æˆåŠŸæˆ–éŒ¯èª¤è¨Šæ¯ -->
	<c:if test="${not empty errorMessage}">
		<div class="alert alert-danger text-center">${errorMessage}</div>
	</c:if>

	<div class="container mt-5">
		<h2 class="text-center mb-4">ğŸ½ èœå–®ä¸€è¦½</h2>

		<table class="table table-bordered table-hover" id="menuTable">
			<thead class="table-dark">
				<tr>
					<th>å•†å“åç¨±</th>
					<th>åº«å­˜</th>
					<th>åœ–ç‰‡</th>
					<th>å–®åƒ¹</th>
					<th>ä»‹ç´¹</th>
					<th>ç‹€æ…‹</th>
					<th>é¡åˆ¥</th>
					<th>æ“ä½œ</th>
				</tr>
			</thead>
			<tbody>
				<c:choose>
					<c:when test="${not empty menuList}">
						<c:forEach var="mn" items="${menuList}">
							<tr>
								<td>${mn.menuName}</td>
								<td>${mn.stock}</td>
								<td><img
									src="${pageContext.request.contextPath}${mn.imageUrl}"
									alt="å•†å“åœ–ç‰‡" class="img-thumbnail"></td>
								<td>${mn.unitPrice}</td>
								<td>${mn.description}</td>
								<td>${mn.status}</td>
								<td>${mn.category}</td>
								<td>
									<button class="edit-btn btn btn-warning"
										data-menu-name="${mn.menuName}">ä¿®æ”¹</button>
									<button class="btn btn-danger delete-btn"
										data-menu-name="${mn.menuName}">åˆªé™¤</button>
								</td>
							</tr>
						</c:forEach>
					</c:when>
					<c:otherwise>
						<tr>
							<td colspan="8" class="text-center text-danger">âŒ æ²’æœ‰æ‰¾åˆ°èœå–®å“é …ã€‚</td>
						</tr>
					</c:otherwise>
				</c:choose>
			</tbody>
		</table>

		<!-- è¿”å›æŒ‰éˆ• -->
		<a href="<%=request.getContextPath()%>/hw2/menupage.html"
			class="btn-back">è¿”å›æŸ¥è©¢é é¢</a>
	</div>

	<!-- JavaScript: jQuery + DataTables -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script
		src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

	<!-- å•Ÿç”¨ DataTables -->
	<script>
        $(document).ready(function(){
        	if ($("#menuTable tbody tr").length > 1) { 
                $('#menuTable').DataTable({
                    "language": {
                        "lengthMenu": "é¡¯ç¤º _MENU_ ç­†è¨˜éŒ„",
                        "zeroRecords": "æ²’æœ‰ç¬¦åˆçš„è¨˜éŒ„",
                        "info": "é¡¯ç¤ºç¬¬ _START_ ç­†åˆ°ç¬¬ _END_ ç­†ï¼Œå…± _TOTAL_ ç­†",
                        "infoEmpty": "æ²’æœ‰å¯é¡¯ç¤ºçš„è¨˜éŒ„",
                        "infoFiltered": "(å¾ _MAX_ ç­†è¨˜éŒ„ä¸­ç¯©é¸)",
                        "search": "æœå°‹ï¼š",
                        "paginate": {
                            "first": "ç¬¬ä¸€é ",
                            "last": "æœ€å¾Œä¸€é ",
                            "next": "ä¸‹ä¸€é ",
                            "previous": "ä¸Šä¸€é "
                        }
                    }
                });
            } else {
                console.log("âŒ æ²’æœ‰è³‡æ–™ï¼Œä¸åˆå§‹åŒ– DataTables");
            }
        });

        // ä¿®æ”¹æŒ‰éˆ•
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll(".edit-btn").forEach(button => {
                button.addEventListener("click", function() {
                    let menuName = this.getAttribute("data-menu-name");
                    if (!menuName) {
                        console.error("âŒ ç„¡æ³•ç²å– menuName");
                        return;
                    }
                    let encodedMenuName = encodeURIComponent(menuName);
                    window.location.href = `/project/hw2/Updatemovie.html?menu_name=` + encodedMenuName;
                });
            });
        });

        // åˆªé™¤æŒ‰
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".delete-btn").forEach(button => {
                button.addEventListener("click", function () {
                    let menuName = this.getAttribute("data-menu-name");
                    if (confirm("ç¢ºå®šè¦åˆªé™¤ã€Œ" + menuName + "ã€å—ï¼Ÿ")) {
                        fetch("/project/DeleteM", {
                            method: "POST",
                            headers: { "Content-Type": "application/x-www-form-urlencoded" },
                            body: "menu_name=" + encodeURIComponent(menuName)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert("âœ… åˆªé™¤æˆåŠŸï¼");
                                location.reload();
                            } else {
                                alert("âŒ åˆªé™¤å¤±æ•—ï¼š" + data.message);
                            }
                        })
                        .catch(error => {
                            console.error("âŒ åˆªé™¤è«‹æ±‚éŒ¯èª¤:", error);
                            alert("âŒ ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
